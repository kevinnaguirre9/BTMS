<%- include('include/_header')%>

<!-- Users list -->

<header id="header">
     <nav>
          <div class="container">
               <div class="text-center">
                    <h1 class="nav-brand text-dark">Administración de Usuarios</h1>
               </div>
          </div>
     </nav>
</header>

<main id="site-main">
     <div class="container">
          <div class="box-nav d-flex justify-between">
               <div class="filter">
                    <a href="/user/home"><i class="fas fa-angle-double-left"></i> Home</a>
                    <a href="/user/allUsers"><i class="fas fa-angle-double-left"></i> Usuarios</a>
               </div>
          </div>
          <div class="form-title text-center">
               <h2 class="text-dark">Editar usuario</h2>
               <span>Actualiza la información de un usuario</span>
          </div>

           <!-- Form handling -->
           <form method="POST" id="user_info" enctype="multipart/form-data">   
               <div>
                    <h4>Información del usuario</h4>
                    <div class="form-group">    
                         <label for="nombres">Nombres</label>
                         <input type="hidden" name="id" value="<%= user._id %>">
                         <input type="text" name="nombres" id="nombres" placeholder="Nombres" class="form-control" 
                         value="<%= user.nombres %>" required>
                    </div>
                    <div class="form-group">
                         <label for="apellidos">Apellidos</label>
                         <input type="text" name="apellidos" id="apellidos" placeholder="Apellidos" class="form-control" value="<%= user.apellidos %>" required>
                    </div>
                    <div class="form-group">
                         <label for="cedula">Cédula</label>
                         <input type="text" name="cedula" id="cedula" placeholder="Cedula" class="form-control" value="<%= user.cedula %>" required>
                    </div>
                    <div class="form-group">
                         <label for="user_photo" id="label_uphoto">Cambiar foto</label>
                         <input type="file" name="user_photo" id="user_photo" class="box" 
                         accept="image/jpeg, image/png" hidden/>
                         <img class="rounded-circle" id="img_uploaded" src="/user/images/<%= user.imgKey %>"/>
                    </div>
                    <div class="form-group">
                         <label for="fechaNacimiento">Fecha de nacimiento</label>
                         <input class="form-control" type="date" id="fechaNacimiento" name="fechaNacimiento" 
                         value="<%= user.fechaNacimiento.toISOString().slice(0, 10) %>" required>
                    </div>
                    <div class="form-group">
                         <label for="sexo">Sexo</label>
                         <select class="form-control" name="sexo" id="sexo" required>
                              <option value="Hombre" <%= user.sexo == "Hombre" ? 'selected' : '' %>>Hombre</option>
                              <option value="Mujer" <%= user.sexo == "Mujer" ? 'selected' : '' %>>Mujer</option>
                              <option value="Otro" <%= user.sexo == "Otro" ? 'selected' : '' %>>Otro</option>
                         </select>
                    </div>
                    <div class="form-group">
                         <label for="celular">Celular</label>
                         <input type="text" name="celular" id="celular" placeholder="Numero celular" class="form-control" value="<%= user.celular %>" required>
                    </div>
                    <div class="form-group">
                         <label for="direccion">Direccion</label>
                         <input type="text" name="direccion" id="direccion" placeholder="Dirección" class="form-control" value="<%= user.direccion %>" required>
                    </div>
                    <div class="form-group">
                         <label for="rol">Rol</label>
                         <select class="form-control" name="rol" id="rol" required>
                              <% for(var i=0; i < roles.length; i++) { %>
                                   <option value=<%= roles[i]._id %> <%= user.rol == roles[i]._id.toString() ? 'selected' : '' %>><%= roles[i].nombre %></option>
                              <% } %>
                         </select>
                    </div>
                    <div class="form-group">
                         <label for="estatus">Estatus</label>
                         <select class="form-control" name="estatus" id="estatus" required>
                              <option value="true" <%= user.activo == true ? 'selected' : '' %>>Activo</option>
                              <option value="false" <%= user.activo == false ? 'selected' : '' %>>Inactivo</option>
                         </select>
                    </div>
                    <div class="form-group">
                         <button type="submit" class="btn btn-success">Actualizar</button>
                    </div>
               </div>
          </form>
          <br>
          <% if(locals.userCredentials){ %>  
               <form method="POST" id="user_email" enctype="multipart/form-data">   
                    <div>
                         <div>
                              <h4>Información de Cuenta</h4>
                         </div>
                         <div class="form-group">
                              <label for="userEmail">Email</label>
                              <input type="hidden" name="id" value="<%= user._id %>">
                              <input type="email" name="userEmail" id="userEmail" placeholder="example@gmail.com" class="form-control" value="<%= userCredentials.email %> " required>
                         </div>
                         <div class="form-group">
                              <button type="submit" class="btn btn-success">Actualizar email</button>
                         </div>
                    </div>
               </form>
               <br>
               <form method="POST" id="user_password" enctype="multipart/form-data">   
                    <div>
                         <div>
                              <h4>Cambiar contraseña</h4>
                         </div>
                         <div class="form-group">    
                              <label for="oldPasswd">Contraseña antigua</label>
                              <input type="hidden" name="id" value="<%= user._id %>">
                              <input type="text" name="oldPasswd" id="oldPasswd" class="form-control" required>
                         </div>
                         <div class="form-group">
                              <label for="newPasswd">Nueva contraseña</label>
                              <input type="text" name="newPasswd" id="newPasswd" class="form-control" required>
                         </div>
                         <div class="form-group">
                              <label for="confPasswd">Confirmar nueva contraseña</label>
                              <input type="text" name="confPasswd" id="confPasswd" class="form-control" required>
                         </div>
                         <div class="form-group">
                              <button type="submit" class="btn btn-success">Actualizar contraseña</button>
                         </div>
                    </div>
               </form>
          <% } %>

          <!-- /Form handling -->
          
     </div>
</main>

<!-- /Users list -->

<%- include('include/_footer')%>

